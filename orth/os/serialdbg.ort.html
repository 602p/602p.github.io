<html>
		<head>
			<title>serialdbg.ort</title>
			<link rel="stylesheet" type="text/css" href="syntax.css">
		</head>
		<body>
			<pre>

<a href="./irqio.ort.html"><span class="orth-T_IMPORT">import irqio</span></a><br/><br/><span class="orth-T_VAR_DECL-type">int</span> <span class="orth-T_VAR_DECL-name">serial_base</span><br/><br/><span class="orth-T_FUNCTIONDECL">function</span><span class="orth-T_ARGLIST_START">(</span><span class="orth-T_ARGLIST_ELEMENT-type">byte</span> <span class="orth-T_ARGLIST_ELEMENT-name">char</span><span class="orth-T_ARGLIST_END">)</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_NAME">kswritebyte</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_RETURNS">-&gt;</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_RETURN_TYPE">void</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_DOES">does</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">write_port</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">serial_base</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">char</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_RETURN">return</span><br/><br/><span class="orth-T_FUNCTIONDECL">function</span><span class="orth-T_ARGLIST_START">(</span><span class="orth-T_ARGLIST_ELEMENT-type">cstr</span> <span class="orth-T_ARGLIST_ELEMENT-name">msg</span><span class="orth-T_ARGLIST_END">)</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_NAME">kswritecstr</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_RETURNS">-&gt;</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_RETURN_TYPE">void</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_DOES">does</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_VAR_DECL-type">int</span> <span class="orth-T_VAR_DECL-name">idx</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">0</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHILE_START">while</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">idx</span><span class="orth-T_BINARY_OPERATOR">&lt;</span><span class="orth-T_NAME">msg</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">len</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kswritebyte</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">msg</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">ptr</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_LIST_START">[</span><span class="orth-T_NAME">idx</span><span class="orth-T_LIST_STOP">]</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">idx</span><span class="orth-T_AUGASSIGN">+=</span><span class="orth-T_INTEGER_LITERAL">1</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_BLOCK_DONE">done</span><br/><span class="orth-T_RETURN">return</span><br/><br/><span class="orth-T_FUNCTIONDECL">function</span><span class="orth-T_ARGLIST_START">(</span><span class="orth-T_ARGLIST_END">)</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_NAME">init_serial</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_RETURNS">-&gt;</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_RETURN_TYPE">void</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_DOES">does</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">serial_base</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">0x3f8</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">write_port</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">serial_base</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">1</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0x00</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_LINE_COMMENT"># Disable all interrupts</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">write_port</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">serial_base</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">3</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0x80</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_LINE_COMMENT"># Enable DLAB (set baud rate divisor)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">write_port</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">serial_base</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0x03</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_LINE_COMMENT"># Set divisor to 3 (lo byte) 38400 baud</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">write_port</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">serial_base</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">1</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0x00</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_LINE_COMMENT">#                  (hi byte)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">write_port</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">serial_base</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">3</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0x03</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_LINE_COMMENT"># 8 bits, no parity, one stop bit</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">write_port</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">serial_base</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">2</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0xC7</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_LINE_COMMENT"># Enable FIFO, clear them, with 14-byte threshold</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_LINE_COMMENT">#write_port(serial_base + 4, 0x0B);   # IRQs enabled, RTS/DSR set</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kswritecstr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Serial Debugger started!\n&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_RETURN">return</span><br/><span class="orth-T_WHITESPACE"> </span>

			</pre>
		</body>
	</html>