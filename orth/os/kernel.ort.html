<html>
		<head>
			<title>kernel.ort</title>
			<link rel="stylesheet" type="text/css" href="syntax.css">
		</head>
		<body>
			<pre>

<a href="./mm.ort.html"><span class="orth-T_IMPORT">import mm</span></a><br/><a href="./term.ort.html"><span class="orth-T_IMPORT">import term</span></a><br/><a href="./panic.ort.html"><span class="orth-T_IMPORT">import panic</span></a><br/><br/><span class="orth-T_VAR_DECL-type">Terminal</span> <span class="orth-T_VAR_DECL-name">kterm</span><br/><span class="orth-T_VAR_DECL-type">int</span> <span class="orth-T_VAR_DECL-name">base_vma</span><br/><span class="orth-T_VAR_DECL-type">ptr</span> <span class="orth-T_VAR_DECL-name">multiboot_data_physaddr</span><br/><br/><a href="./irqio.ort.html"><span class="orth-T_IMPORT">import irqio</span></a><br/><a href="./keymap_us.ort.html"><span class="orth-T_IMPORT">import keymap_us</span></a><br/><a href="./console.ort.html"><span class="orth-T_IMPORT">import &quot;kapps/console.ort&quot;</span></a><br/><a href="./mbdata.ort.html"><span class="orth-T_IMPORT">import mbdata</span></a><br/><br/><a href="./serialdbg.ort.html"><span class="orth-T_IMPORT">import serialdbg</span></a><br/><a href="./vgatest.ort.html"><span class="orth-T_IMPORT">import vgatest</span></a><br/><a href="./gfxterm.ort.html"><span class="orth-T_IMPORT">import gfxterm</span></a><br/><a href="./util.ort.html"><span class="orth-T_IMPORT">import util</span></a><br/><a href="./err.ort.html"><span class="orth-T_IMPORT">import &quot;profiling/err.ort&quot;</span></a><br/><a href="./profile.ort.html"><span class="orth-T_IMPORT">import &quot;profiling/profile.ort&quot;</span></a><br/><br/><a href="./paging.ort.html"><span class="orth-T_IMPORT">import paging</span></a><br/><span class="orth-T_LINE_COMMENT">#import thunk</span><br/><br/><span class="orth-T_VAR_DECL-type">MultibootInfo</span> <span class="orth-T_VAR_DECL-name">mbinfo</span><br/><br/><span class="orth-T_FUNCTIONDECL">function</span><span class="orth-T_ARGLIST_START">(</span><span class="orth-T_ARGLIST_ELEMENT-type">ptr</span> <span class="orth-T_ARGLIST_ELEMENT-name">multiboot_struct_addr</span><span class="orth-T_ARGLIST_END">)</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_NAME">kernel_main</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_RETURNS">-&gt;</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_RETURN_TYPE">void</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_FUNCTIONDECL_DOES">does</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">multiboot_data_physaddr</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_NAME">multiboot_struct_addr</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">base_vma</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">0xC0000000</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">init_serial</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kswritecstr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Kernel debugger check!\n&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">KMM</span><span class="orth-T_DOUBLECOLON">::</span><span class="orth-T_NAME-accessor">init</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">base_vma</span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_INTEGER_LITERAL">0x300000</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_LINE_COMMENT">#(Hopefully) skip past all the multiboot data we care about</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">MultibootInfo</span><span class="orth-T_DOUBLECOLON">::</span><span class="orth-T_NAME-accessor">load</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">multiboot_struct_addr</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">init_pm</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_LINE_COMMENT">#Early PM init so we can page the screen</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_VAR_DECL-type">int</span> <span class="orth-T_VAR_DECL-name">mappos</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">0x400000</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHILE_START">while</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">mappos</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BINARY_OPERATOR">&lt;</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_INTEGER_LITERAL">0x400000</span><span class="orth-T_BINARY_OPERATOR">*</span><span class="orth-T_INTEGER_LITERAL">10</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">page_manager</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">get_pde_slot_addr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">base_vma</span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_NAME">mappos</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">set</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mappos</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">1</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">bool</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">mappos</span><span class="orth-T_AUGASSIGN">+=</span><span class="orth-T_INTEGER_LITERAL">0x400000</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_BLOCK_DONE">done</span><br/><br/><span class="orth-T_WHITESPACE">	</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_IF_START">if</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">text_mode</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kswritecstr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Text Mode\n&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">Terminal</span><span class="orth-T_DOUBLECOLON">::</span><span class="orth-T_NAME-accessor">new</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">fb_addr</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">80</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">25</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">_null_updater</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">TerminalUpdateHook</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_IF_BLOCK_END_ON_ELSE">els</span><span class="orth-T_IF_ELSE">e</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kswritecstr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Graphical mode. Paging...\n&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">page_manager</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">get_pde_slot_addr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">fb_addr</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">set</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">fb_raw_addr</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">1</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">bool</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">page_manager</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">get_pde_slot_addr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">fb_addr</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0x400000</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">set</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">fb_raw_addr</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">1</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">bool</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kswritecstr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Paged\n&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_IF_START">if</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">cmdline</span><span class="orth-T_BINARY_OPERATOR">==</span><span class="orth-T_STRING_LITERAL">&quot;gfxtest&quot;</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">test_svga</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_BLOCK_DONE">done</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">init_emulator</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mbinfo</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">Terminal</span><span class="orth-T_DOUBLECOLON">::</span><span class="orth-T_NAME-accessor">new</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">console_emulator</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">text_fb</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">console_emulator</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">vga_w</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">console_emulator</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">vga_h</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">_update_framebuffer</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">TerminalUpdateHook</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_BLOCK_DONE">done</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kswritecstr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Blanking...&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">blank</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kswritecstr</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;*\n&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Terminal ready&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;  ..---..&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; /       \\&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;|         |&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;:         ;&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; \\  \\&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printa</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_INTEGER_LITERAL">0x0E</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_STRING_LITERAL">&quot;~&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;/  /&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;  `, Y ,&#x27;&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;   |_|_|&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;   |===|&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;   |===|&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;    \\_/&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;\nOrth OS. Louis G.&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Higher-Half addressing enabled, base_vma=&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">dumphexi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">base_vma</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;. kterm.baseaddr=&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">dumphexi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">kterm</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">baseaddr</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_WHITESPACE">	</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;\nCS=&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">__kgetcs</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; DS=&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">__kgetds</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; Installing GDT: &quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">install_gdt</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; Done! &quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;CS=&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">__kgetcs</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; DS=&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">__kgetds</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;\nTesting (some) Memory: &quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_VAR_DECL-type">int</span> <span class="orth-T_VAR_DECL-name">mt_x</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_NAME">kterm</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">cursor_x</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">serial_debug_enabled</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">0</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">bool</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_VAR_DECL-type">int</span> <span class="orth-T_VAR_DECL-name">testpos</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_INTEGER_LITERAL">0</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHILE_START">while</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">testpos</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_BINARY_OPERATOR">&lt;</span><span class="orth-T_INTEGER_LITERAL">0x100000</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">mm_pos</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">offset</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">testpos</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_LIST_START">[</span><span class="orth-T_INTEGER_LITERAL">0</span><span class="orth-T_LIST_STOP">]</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">0</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">byte</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">testpos</span><span class="orth-T_AUGASSIGN">+=</span><span class="orth-T_INTEGER_LITERAL">8</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_BLOCK_DONE">done</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_DOT">.</span><span class="orth-T_NAME-accessor">serial_debug_enabled</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">1</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">bool</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Done, at least &quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">testpos</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;b accessible off &#x27;heap&#x27;&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Installing IRQs: &quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">setup_irq</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Installed!&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Mutiboot structure physaddr=&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">dumphexi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">multiboot_struct_addr</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;. vaddr?=&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">dumphexi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">multiboot_struct_addr</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_BINARY_OPERATOR">+</span><span class="orth-T_NAME">base_vma</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_IF_START">if</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">multiboot_struct_addr</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_BINARY_OPERATOR">&lt;</span><span class="orth-T_INTEGER_LITERAL">0x400000</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; OK\n&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_IF_BLOCK_END_ON_ELSE">els</span><span class="orth-T_IF_ELSE">e</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; OUTSIDE MAP!&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_BLOCK_DONE">done</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;Heap ptr at &quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">dumphexi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mm_head</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; , heap pos at &quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">dumphexi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mm_pos</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot; (&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printi</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mm_pos</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_BINARY_OPERATOR">-</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">mm_head</span><span class="orth-T_CAST">|</span><span class="orth-T_NAME-cast-type">int</span><span class="orth-T_PAREN_CLOSE">)</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printl</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;b consumed)&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;BG Colors 0-16, FG Colors:&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_VAR_DECL-type">int</span> <span class="orth-T_VAR_DECL-name">bg_idx</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">0x0F</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHILE_START">while</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">bg_idx</span><span class="orth-T_BINARY_OPERATOR">&lt;=</span><span class="orth-T_INTEGER_LITERAL">0xFF</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printa</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">bg_idx</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_STRING_LITERAL">&quot;.&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">bg_idx</span><span class="orth-T_AUGASSIGN">+=</span><span class="orth-T_INTEGER_LITERAL">0x10</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_BLOCK_DONE">done</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_VAR_DECL-type">int</span> <span class="orth-T_VAR_DECL-name">fg_idx</span><span class="orth-T_ASSIGNMENT">=</span><span class="orth-T_INTEGER_LITERAL">0x00</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHILE_START">while</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_NAME">fg_idx</span><span class="orth-T_BINARY_OPERATOR">&lt;=</span><span class="orth-T_INTEGER_LITERAL">0x0F</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_BLOCK_DO">do</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">printa</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_NAME">fg_idx</span><span class="orth-T_COMMA">,</span><span class="orth-T_WHITESPACE"> </span><span class="orth-T_STRING_LITERAL">&quot;X&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">fg_idx</span><span class="orth-T_AUGASSIGN">+=</span><span class="orth-T_INTEGER_LITERAL">1</span><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_BLOCK_DONE">done</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">init_keymap</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">orth</span><span class="orth-T_DOUBLECOLON">::</span><span class="orth-T_NAME-accessor">internal</span><span class="orth-T_DOUBLECOLON">::</span><span class="orth-T_NAME-accessor">hooks</span><span class="orth-T_DOUBLECOLON">::</span><span class="orth-T_NAME-accessor">enable_err</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kterm</span><span class="orth-T_COLON">:</span><span class="orth-T_NAME-accessor">print</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_STRING_LITERAL">&quot;\n\nREADY&quot;</span><span class="orth-T_PAREN_CLOSE">)</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_LINE_COMMENT">#test_thunk()</span><br/><br/><span class="orth-T_WHITESPACE">	</span><span class="orth-T_NAME">kconsole_run</span><span class="orth-T_PAREN_OPEN">(</span><span class="orth-T_PAREN_CLOSE">)</span><br/><span class="orth-T_RETURN">return</span><br/><span class="orth-T_WHITESPACE"> </span>

			</pre>
		</body>
	</html>